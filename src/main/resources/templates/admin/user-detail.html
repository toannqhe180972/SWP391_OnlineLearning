<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>User Detail - Admin</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <header>
        <div class="container nav">
            <a th:href="@{/home}" class="logo">OnlineLearning</a>
            <div class="nav-links">
                <a th:href="@{/home}">Home</a>
                <a th:href="@{/admin/users}" sec:authorize="hasRole('ADMIN')">Users</a>
                <a th:href="@{/admin/settings}" sec:authorize="hasRole('ADMIN')">Settings</a>
                <a th:href="@{/admin/audit-logs}" sec:authorize="hasRole('ADMIN')">Audit Logs</a>
                <a th:href="@{/profile}">Profile</a>
                <form th:action="@{/logout}" method="post" style="display:inline;"><button type="submit"
                        style="background:none;border:none;color:#4f46e5;cursor:pointer;font-weight:500;">Logout</button>
                </form>
            </div>
        </div>
    </header>
    <main class="container">
        <div class="auth-card" style="max-width:700px;">
            <h2 th:text="${user != null ? 'Edit User' : 'Add New User'}"></h2>
            <div th:if="${error}" style="color:red;margin-bottom:1rem;" th:text="${error}"></div>

            <div th:if="${user != null}" style="text-align:center;margin-bottom:2rem;">
                <img th:src="${user.avatarUrl != null ? user.avatarUrl : 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}"
                    style="width:100px;height:100px;border-radius:50%;object-fit:cover;">
            </div>

            <form th:action="${user != null ? '/admin/users/' + user.id : '/admin/users'}" method="post">
                <div th:if="${user == null}">
                    <div class="form-group"><label>Username</label><input type="text" name="username" required></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                        <div class="form-group"><label>First Name</label><input type="text" name="firstName" required>
                        </div>
                        <div class="form-group"><label>Last Name</label><input type="text" name="lastName" required>
                        </div>
                    </div>
                    <div class="form-group"><label>Email</label><input type="email" name="email" required></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                        <div class="form-group"><label>Gender</label>
                            <select name="gender" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Mobile</label><input type="text" name="mobile"></div>
                    </div>
                    <div class="form-group"><label>Address</label><input type="text" name="address"></div>
                </div>

                <div th:if="${user != null}">
                    <div class="form-group"><label>Username (Read-only)</label><input type="text"
                            th:value="${user.username}" readonly style="background:#f4f4f4;"></div>
                    <div class="form-group"><label>Full Name (Read-only)</label><input type="text"
                            th:value="${user.fullName}" readonly style="background:#f4f4f4;"></div>
                    <div class="form-group"><label>Email (Read-only)</label><input type="text" th:value="${user.email}"
                            readonly style="background:#f4f4f4;"></div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                    <div class="form-group"><label>Role</label>
                        <select name="roleId" required>
                            <option th:each="role:${roles}" th:value="${role.id}" th:text="${role.name}"
                                th:selected="${user != null && user.roles.contains(role)}"></option>
                        </select>
                    </div>
                    <div class="form-group"><label>Status</label>
                        <select name="status" required>
                            <option th:each="s:${statuses}" th:value="${s}" th:text="${s}"
                                th:selected="${user != null && user.status == s}"></option>
                        </select>
                    </div>
                </div>

                <div style="display:flex;gap:1rem;margin-top:1.5rem;">
                    <button type="submit" class="btn btn-primary"
                        th:text="${user != null ? 'Update' : 'Create & Send Password'}"></button>
                    <a th:href="@{/admin/users}" class="btn">Cancel</a>
                </div>
            </form>
            <p th:if="${user == null}" style="margin-top:1rem;color:#64748b;font-size:0.875rem;">
                * A random password will be generated and sent to the user's email.
            </p>
            <p th:if="${user != null}" style="margin-top:1rem;color:#64748b;font-size:0.875rem;">
                * Admin can only edit Role and Status. Personal information cannot be changed here.
            </p>
        </div>
    </main>
</body>

</html>